# Data sources

## Mealyzer application and functionality

Our data is collected from a proprietary application contributed by Kliment which allows users to record their blood glucose level before and after a meal, what they eat for a meal, counts of how many meals exist for each user, the estimation of calorie level of their meals, activity & sleep data from Fitbit devices, and images of what user consumes for each meal. The original data is pulled using code in a GitHub repository and saved in the local dropbox, which contains an individual directory for each user's data.

## Dataset description

BG Readings: The bg_readings data contains information of all blood glucose values recorded at a given timestamp, in mg/dl, for a particular meal, before or after the meal; columns include: time, bg, meals_kind, meal_id, and readings_kind.
Meals: The meals data contains all information about each meal the users consumed, including time, meal title, ingredients, meal kind, nutrients evaluation and calories estimation by experts and by users themselves, and nutrient proportions, etc.
Activities: Only a small portion of users opted-in and shared Fitbit data. We are provided the activities-steps file and the activities-distance file for each user with Fitbit device available. In both files, time is the number of minutes since the anchor_date, while value is the value recorded for that timestamp - either number of steps or distance (in miles). Since the distance data is merely a linear function of the number of steps data, we use the steps data as a proxy for userâ€™s activity level in this project. *anchor_data: midnight eastern on the day before the first meal recording
Sleep: Only a small portion of users opted-in and shared Fitbit data. In the sleep_overview file for each user, we see the date of sleep, duration, minutes asleep, time in bed, etc. We mainly use minutesAsleep as the proxy for sleep data and compare that with activities and meals data in this project. 
Meal Photos: Images are in the images folder in each user directory. Users are expected to submit their meal photos for evaluations by the professional nutritionist evaluators. Once the meal photos are uploaded in the app, information on nutritional composition of their meals is recorded and can be found in the meals data. 


## Dataset collection artifacts

pre and post meal bg times

evaluator


```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.asp=0.618, out.width="100%", echo = TRUE, warning=FALSE, message=FALSE)
library(tidyverse)
library(lubridate)
library(forcats)
library(r2d3)
library(parcoords)
library(dplyr)
```

## Data Import


```{r}
raw_data_path = "~/Dropbox/MealyzerData"
users.raw = read_csv(file.path(raw_data_path, "mealyzer_data_overview.csv"), col_types = cols())
glimpse(users.raw)
```


```{r}
read.mealyzer_files <- function(data_dir, user_ids, file_name, add_user_id, col_types) {
  result <- c()
  for (user_id in user_ids) {
    
    file_path = file.path(data_dir, as.character(user_id), file_name)
    df = read_csv(file_path, col_types = col_types)
    if (add_user_id) {
      df = cbind(user_id = user_id, df)
    }
    if (length(result) == 0) {
      result <- df
    } else {
      result <- rbind(result, df)
    }
  }
  return(result)
}
```

```{r}
bg_readings.raw = read.mealyzer_files(raw_data_path, users.raw[["user_id"]], "bg_labeled.csv", add_user_id = TRUE, col_types = cols(
  time = col_double(),
  bg = col_double(),
  meals_kind = col_character(),
  meal_id = col_double(),
  readings_kind = col_character()
))
glimpse(bg_readings.raw)
```


```{r}
meals.raw = read.mealyzer_files(raw_data_path, users.raw[["user_id"]], "mealyzer_data.csv", add_user_id = FALSE, col_types = cols()) 
glimpse(meals.raw)
```